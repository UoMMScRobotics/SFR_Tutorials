

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adding Simulation Properties &mdash; Software for Robotics Tutorials  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
      <link rel="stylesheet" type="text/css" href="_static/theme_mods.css?v=a1f80f96" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
      <script src="_static/doctools.js?v=888ff710"></script>
      <script src="_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script src="_static/design-tabs.js?v=36754332"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Linking Gazebo and ROS2" href="week08_tut_gazeboros.html" />
    <link rel="prev" title="Setting Up a Simulation in Gazebo" href="week08_tut_intro.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="contents.html" class="icon icon-home">
            Software for Robotics Tutorials
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Welcome</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Software for Robotics Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 07 | URDF</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_intro.html">Describing Robots using URDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_joints.html">Adding Joints</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_links.html">Adding Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_collisions.html">Adding Collisions and Inertia</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 08 | Simulations</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="week08_tut_intro.html">Setting Up a Simulation in Gazebo</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Adding Simulation Properties</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#adding-gazebo-information">Adding Gazebo Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#joint-state-publisher">Joint State Publisher</a></li>
<li class="toctree-l2"><a class="reference internal" href="#differential-drive-controller">Differential Drive Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sensors">Sensors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lidar">Lidar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imu">IMU</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#general-physics">General physics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="week08_tut_gazeboros.html">Linking Gazebo and ROS2</a></li>
<li class="toctree-l1"><a class="reference internal" href="week08_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 09 | Maps and SLAM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_intro.html">Sensing and Perception for Navigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_maps.html">Maps and Occupancy Grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_localisation.html">Localisation in a Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_slam.html">SLAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 10 | Autonomous Navigation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_intro.html">Autonomous Navigation Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_pathplan.html">Adding Path Planning from Nav2</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_controller.html">Adding a Controller from Nav2</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_commands.html">Sending Goals to the Robot Navigation Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 11 | Behaviour Trees</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_intro.html">Behaviour Trees Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_groot.html">Investigating Behaviour Trees with Groot</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_simplebt.html">Building a Behaviour Tree with Groot</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_usingsimplebt.html">Using a Custom Behaviour Tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_addreplanning.html">Adding Replanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_conclusion.html">Conclusion</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="contents.html">Software for Robotics Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="contents.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Adding Simulation Properties</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="adding-simulation-properties">
<h1>Adding Simulation Properties<a class="headerlink" href="#adding-simulation-properties" title="Permalink to this heading"></a></h1>
<p>Open the file <code class="docutils literal notranslate"><span class="pre">/urdf/diff_drive.urdf.xacro</span></code> and take a brief look at the contents. Notice that links have <code class="docutils literal notranslate"><span class="pre">&lt;interial&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;collision&gt;</span></code> tags - this makes for quite a lengthy looking file.  The interia matrix can be found online for simple geometries (sphere, box, cylinder), or if you have a mesh file you can find the inertia matrix from CAD software or software like <a class="reference external" href="https://www.meshlab.net/">Meshlab</a> or <a class="reference external" href="https://www.danielgm.net/cc/">Cloudcompare</a>.  These are critical for the Gazebo physics engine to handle things properly.</p>
<p>This is also the case for real robots!  Manipulators for example often need an accurate estimate of the centre of mass and sometimes interia matrix to handle an end-effector or payload correctly.  These were touched upon when looking at <a class="reference internal" href="week07_tut_collisions.html"><span class="doc">URDF files in general</span></a>, this tutorial will focus on additions needed for simulation.</p>
<section id="adding-gazebo-information">
<h2>Adding Gazebo Information<a class="headerlink" href="#adding-gazebo-information" title="Permalink to this heading"></a></h2>
<p>At the bottom of <code class="docutils literal notranslate"><span class="pre">/urdf/diff_drive.urdf.xacro</span></code>, on line 213 we include another file called <code class="docutils literal notranslate"><span class="pre">/urdf/example_gazebo.xacro</span></code>.  To make things easier to read, this will contain all the necessary components for simulation.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos">213</span><span class="nt">&lt;xacro:include</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;$(find example_urdf_robot)/urdf/example_gazebo.xacro&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span></pre></div>
</div>
<p>Open the <code class="docutils literal notranslate"><span class="pre">example_urdf_robot/urdf/example_gazebo.xacro</span></code> file in your text editor of choice.  We will walk through each portion individually.</p>
</section>
<section id="joint-state-publisher">
<h2>Joint State Publisher<a class="headerlink" href="#joint-state-publisher" title="Permalink to this heading"></a></h2>
<p>The joint state publisher provides regular publishing of the joint information from the simulation.  In this case, it would be the angular velocity of the left and right wheels.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="linenos"> 2</span><span class="nt">&lt;robot</span><span class="w"> </span><span class="na">xmlns:xacro=</span><span class="s">&quot;http://www.ros.org/wiki/xacro&quot;</span><span class="nt">&gt;</span>
<span class="linenos"> 3</span><span class="w"> </span>
<span class="linenos"> 4</span><span class="w"> </span><span class="cm">&lt;!-- GAZEBO PLUGINS --&gt;</span>
<span class="linenos"> 5</span><span class="w">  </span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="cm">&lt;!-- List all movable joints --&gt;</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="cm">&lt;!-- https://gazebosim.org/api/gazebo/6/classignition_1_1gazebo_1_1systems_1_1JointStatePublisher.html --&gt;</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="nt">&lt;gazebo&gt;</span>
<span class="linenos">10</span><span class="w">      </span><span class="nt">&lt;plugin</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;ignition-gazebo-joint-state-publisher-system&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ignition::gazebo::systems::JointStatePublisher&quot;</span><span class="nt">&gt;</span>
<span class="linenos">11</span><span class="w">        </span><span class="nt">&lt;update_rate&gt;</span>100<span class="nt">&lt;/update_rate&gt;</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">&lt;joint_name&gt;</span>base_wheel_left_joint<span class="nt">&lt;/joint_name&gt;</span>
<span class="linenos">13</span><span class="w">        </span><span class="nt">&lt;joint_name&gt;</span>base_wheel_right_joint<span class="nt">&lt;/joint_name&gt;</span>
<span class="linenos">14</span><span class="w">        </span>
<span class="linenos">15</span><span class="w">        </span><span class="cm">&lt;!-- &lt;topic&gt;/world/&lt;world_name&gt;/model/&lt;model_name&gt;/joint_state&lt;/topic&gt; THIS IS DEFAULT --&gt;</span>
<span class="linenos">16</span><span class="w">        </span><span class="nt">&lt;topic&gt;</span>/model/diff_drive_example/joint_state<span class="nt">&lt;/topic&gt;</span><span class="w"> </span><span class="cm">&lt;!-- remove world leading prefixes --&gt;</span>
<span class="linenos">17</span><span class="w">      </span><span class="nt">&lt;/plugin&gt;</span>
<span class="linenos">18</span><span class="w">  </span><span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<p>By default, all (moveable) joint states are published by Gazebo when we include the <a class="reference external" href="https://gazebosim.org/api/gazebo/6/classignition_1_1gazebo_1_1systems_1_1JointStatePublisher.html">JointStatePublisher</a> plugin.  If we remove these two lines defining the joints we are interested in, it will still work.  However, for completeness specifying the joints has been included.  Defining joints manually is good practice to avoid unnecessary use of bandwidth.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos">12</span><span class="w">        </span><span class="nt">&lt;joint_name&gt;</span>base_wheel_left_joint<span class="nt">&lt;/joint_name&gt;</span>
</span><span class="hll"><span class="linenos">13</span><span class="w">        </span><span class="nt">&lt;joint_name&gt;</span>base_wheel_right_joint<span class="nt">&lt;/joint_name&gt;</span>
</span></pre></div>
</div>
</section>
<section id="differential-drive-controller">
<h2>Differential Drive Controller<a class="headerlink" href="#differential-drive-controller" title="Permalink to this heading"></a></h2>
<p>Gazebo offers a plugin for a differential drive controller.  It takes in arguments regarding wheel radius and wheel separation, and provides the necessary wheel angular velocities - how helpful!</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos">19</span><span class="w">  </span><span class="cm">&lt;!-- Differential Drive --&gt;</span>
<span class="linenos">20</span><span class="w">  </span><span class="cm">&lt;!-- https://gazebosim.org/api/gazebo/6/classignition_1_1gazebo_1_1systems_1_1DiffDrive.html --&gt;</span>
<span class="linenos">21</span><span class="w">  </span><span class="nt">&lt;gazebo&gt;</span>
<span class="linenos">22</span><span class="w">    </span><span class="nt">&lt;plugin</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;ignition-gazebo-diff-drive-system&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ignition::gazebo::systems::DiffDrive&quot;</span><span class="nt">&gt;</span>
<span class="linenos">23</span><span class="w">      </span><span class="cm">&lt;!-- Wheel Joints --&gt;</span>
<span class="linenos">24</span><span class="w">      </span><span class="nt">&lt;left_joint&gt;</span>base_wheel_left_joint<span class="nt">&lt;/left_joint&gt;</span>
<span class="linenos">25</span><span class="w">      </span><span class="nt">&lt;right_joint&gt;</span>base_wheel_right_joint<span class="nt">&lt;/right_joint&gt;</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="w">      </span><span class="cm">&lt;!-- Kinematics --&gt;</span>
<span class="linenos">28</span><span class="w">      </span><span class="nt">&lt;wheel_separation&gt;</span>${base_link_y<span class="w"> </span>+<span class="w"> </span>wheel_length}<span class="nt">&lt;/wheel_separation&gt;</span>
<span class="linenos">29</span><span class="w">      </span><span class="nt">&lt;wheel_radius&gt;</span>${wheel_radius}<span class="nt">&lt;/wheel_radius&gt;</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="w">      </span><span class="nt">&lt;odom_publish_frequency&gt;</span>50<span class="nt">&lt;/odom_publish_frequency&gt;</span>
<span class="linenos">32</span><span class="w">      </span>
<span class="linenos">33</span><span class="w">      </span><span class="cm">&lt;!-- TF Frames --&gt;</span>
<span class="linenos">34</span><span class="w">      </span><span class="nt">&lt;frame_id&gt;</span>/odom<span class="nt">&lt;/frame_id&gt;</span>
<span class="linenos">35</span><span class="w">      </span><span class="nt">&lt;child_frame_id&gt;</span>/base_footprint<span class="nt">&lt;/child_frame_id&gt;</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="w">      </span><span class="cm">&lt;!-- topics --&gt;</span>
<span class="linenos">38</span><span class="w">      </span><span class="cm">&lt;!-- &lt;topic&gt;/model/diff_drive_example/cmd_vel&lt;/topic&gt; THIS IS DEFAULT --&gt;</span>
<span class="linenos">39</span><span class="w">      </span><span class="cm">&lt;!-- &lt;odom_topic&gt;/model/diff_drive_example/odometry&lt;/odom_topic&gt; THIS IS DEFAULT--&gt;</span>
<span class="linenos">40</span><span class="w">      </span><span class="cm">&lt;!-- &lt;tf_topic&gt;/model/diff_drive_example/tf&lt;/tf_topic&gt; THIS IS DEFAULT --&gt;</span>
<span class="linenos">41</span><span class="w">      </span><span class="cm">&lt;!-- &lt;tf_topic&gt;&lt;/tf_topic&gt; Leave blank if you plan to use a filter + imu (e.g. EKF) --&gt;</span>
<span class="linenos">42</span><span class="w">    </span><span class="nt">&lt;/plugin&gt;</span>
<span class="linenos">43</span><span class="w">  </span><span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<p>Firstly, we tell Gazebo which moveable joints are part of the differential drive system - in this case the left and right wheels.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos">24</span><span class="w">      </span><span class="cm">&lt;!-- Wheel Joints --&gt;</span>
<span class="hll"><span class="linenos">25</span><span class="w">      </span><span class="nt">&lt;left_joint&gt;</span>base_wheel_left_joint<span class="nt">&lt;/left_joint&gt;</span>
</span><span class="hll"><span class="linenos">26</span><span class="w">      </span><span class="nt">&lt;right_joint&gt;</span>base_wheel_right_joint<span class="nt">&lt;/right_joint&gt;</span>
</span></pre></div>
</div>
<p>Secondly, we give the kinematics to calculate motor velocities correctly.  Notice that as a xacro, it is possible to use variables from the main .urdf.xacro file  (e.g. <code class="docutils literal notranslate"><span class="pre">${wheel_radius}</span></code>) - super helpful!.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos">28</span><span class="w">      </span><span class="cm">&lt;!-- Kinematics --&gt;</span>
<span class="hll"><span class="linenos">29</span><span class="w">      </span><span class="nt">&lt;wheel_separation&gt;</span>${base_link_y<span class="w"> </span>+<span class="w"> </span>wheel_length}<span class="nt">&lt;/wheel_separation&gt;</span>
</span><span class="hll"><span class="linenos">30</span><span class="w">      </span><span class="nt">&lt;wheel_radius&gt;</span>${wheel_radius}<span class="nt">&lt;/wheel_radius&gt;</span>
</span></pre></div>
</div>
<p>Thirdly, we setup information regarding transformations and estimates of robot position.  The <cite>odom</cite> information is the estimate the robot has of its pose using dead reckoning.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos">32</span><span class="w">      </span><span class="nt">&lt;odom_publish_frequency&gt;</span>50<span class="nt">&lt;/odom_publish_frequency&gt;</span>
</span><span class="linenos">33</span><span class="w">      </span>
<span class="linenos">34</span><span class="w">      </span><span class="cm">&lt;!-- TF Frames --&gt;</span>
<span class="hll"><span class="linenos">35</span><span class="w">      </span><span class="nt">&lt;frame_id&gt;</span>/odom<span class="nt">&lt;/frame_id&gt;</span>
</span><span class="hll"><span class="linenos">36</span><span class="w">      </span><span class="nt">&lt;child_frame_id&gt;</span>/base_footprint<span class="nt">&lt;/child_frame_id&gt;</span>
</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">odom_publish_frequency</span></code> is simply how often we want the differential drive controller to provide the dead reckoning odometry estimate.  The <code class="docutils literal notranslate"><span class="pre">&lt;frame_id&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;child_frame_id&gt;</span></code> are simply the frame names for where the robot starts and where to connect the transform to.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Remember, despite being a simulation, issues such as wheel slip will mean that the odometry estimate <em>will</em> accumulate errors.  There are methods to extract the exact pose by different means in Gazebo if you require a ground truth pose estimate.</p>
</div>
<p>Finally, we can specify topic names explictly as listed in <a class="reference external" href="https://gazebosim.org/api/gazebo/6/classignition_1_1gazebo_1_1systems_1_1DiffDrive.html">DiffDrive</a> documentation.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos">38</span><span class="w">      </span><span class="cm">&lt;!-- topics --&gt;</span>
<span class="hll"><span class="linenos">39</span><span class="w">      </span><span class="cm">&lt;!-- &lt;topic&gt;/model/diff_drive_example/cmd_vel&lt;/topic&gt; THIS IS DEFAULT --&gt;</span>
</span><span class="hll"><span class="linenos">40</span><span class="w">      </span><span class="cm">&lt;!-- &lt;odom_topic&gt;/model/diff_drive_example/odometry&lt;/odom_topic&gt; THIS IS DEFAULT--&gt;</span>
</span><span class="hll"><span class="linenos">41</span><span class="w">      </span><span class="cm">&lt;!-- &lt;tf_topic&gt;/model/diff_drive_example/tf&lt;/tf_topic&gt; THIS IS DEFAULT --&gt;</span>
</span><span class="hll"><span class="linenos">42</span><span class="w">      </span><span class="cm">&lt;!-- &lt;tf_topic&gt;&lt;/tf_topic&gt; Leave blank if you plan to use a filter + imu (e.g. EKF) --&gt;</span>
</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this example, we have omitted parameters such as:
* min/max jerk (linear and angular)
* min/max acceleration (linear and angular)
* min/max velocity (linear and angular)</p>
<p>All these can be found in the <a class="reference external" href="https://gazebosim.org/api/gazebo/6/classignition_1_1gazebo_1_1systems_1_1DiffDrive.html">DiffDrive</a> documentation.</p>
<p>As a “best practice” approach, it is usually sensible to add acceleration and velocity limits.  This applies to real robots too, to avoid “jerky” motions.</p>
</div>
</section>
<section id="sensors">
<h2>Sensors<a class="headerlink" href="#sensors" title="Permalink to this heading"></a></h2>
<p>Gazebo offers a range of sensors which can be included in simulation.  Note that not all sensors have been implemented yet (see <a class="reference external" href="https://gazebosim.org/docs/fortress/comparison/">comparison chart</a>), but most are available.  Furthermore, it is possible to write your own plugins for sensors or noise models, but that is beyond the scope of this tutorial.</p>
<p>Sensors must be attached to a coordinate frame using the <code class="docutils literal notranslate"><span class="pre">&lt;frame_id&gt;</span></code>.  For sensors such as cameras or lidars, usually there exists an link defined in the URDF.  However, for sensors such as an IMU these are arbitrarily attached to the robot chassis without the need for a specific link.  Sensors also need an <code class="docutils literal notranslate"><span class="pre">&lt;update_rate&gt;</span></code> tag to state how often they will publish data.</p>
<section id="lidar">
<h3>Lidar<a class="headerlink" href="#lidar" title="Permalink to this heading"></a></h3>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos">48</span><span class="w">  </span><span class="nt">&lt;gazebo</span><span class="w"> </span><span class="na">reference=</span><span class="s">&quot;lidar_link&quot;</span><span class="nt">&gt;</span>
<span class="linenos">49</span><span class="w">    </span><span class="nt">&lt;sensor</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gpu_lidar&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;generic_lidar_sensor&quot;</span><span class="nt">&gt;</span>
<span class="linenos">50</span>
<span class="linenos">51</span><span class="w">      </span><span class="nt">&lt;topic&gt;</span>/model/diff_drive_example/scan<span class="nt">&lt;/topic&gt;</span>
<span class="linenos">52</span><span class="w">      </span><span class="nt">&lt;frame_id&gt;</span>lidar_link<span class="nt">&lt;/frame_id&gt;</span>
<span class="linenos">53</span><span class="w">      </span><span class="nt">&lt;ignition_frame_id&gt;</span>lidar_link<span class="nt">&lt;/ignition_frame_id&gt;</span>
<span class="linenos">54</span>
<span class="linenos">55</span><span class="w">      </span><span class="nt">&lt;update_rate&gt;</span>15.0<span class="nt">&lt;/update_rate&gt;</span>
<span class="linenos">56</span><span class="w">      </span><span class="nt">&lt;ray&gt;</span>
<span class="linenos">57</span><span class="w">        </span><span class="nt">&lt;scan&gt;</span>
<span class="linenos">58</span><span class="w">          </span><span class="nt">&lt;horizontal&gt;</span>
<span class="linenos">59</span><span class="w">            </span><span class="nt">&lt;samples&gt;</span>270<span class="nt">&lt;/samples&gt;</span>
<span class="linenos">60</span><span class="w">            </span><span class="nt">&lt;resolution&gt;</span>1<span class="nt">&lt;/resolution&gt;</span>
<span class="linenos">61</span><span class="w">            </span><span class="nt">&lt;min_angle&gt;</span>-${pi*0.75}<span class="nt">&lt;/min_angle&gt;</span>
<span class="linenos">62</span><span class="w">            </span><span class="nt">&lt;max_angle&gt;</span>${pi*0.75}<span class="nt">&lt;/max_angle&gt;</span>
<span class="linenos">63</span><span class="w">          </span><span class="nt">&lt;/horizontal&gt;</span>
<span class="linenos">64</span><span class="w">        </span><span class="nt">&lt;/scan&gt;</span>
<span class="linenos">65</span><span class="w">        </span><span class="nt">&lt;range&gt;</span>
<span class="linenos">66</span><span class="w">          </span><span class="nt">&lt;min&gt;</span>0.10<span class="nt">&lt;/min&gt;</span>
<span class="linenos">67</span><span class="w">          </span><span class="nt">&lt;max&gt;</span>8.0<span class="nt">&lt;/max&gt;</span>
<span class="linenos">68</span><span class="w">          </span><span class="nt">&lt;resolution&gt;</span>0.06<span class="nt">&lt;/resolution&gt;</span>
<span class="linenos">69</span><span class="w">        </span><span class="nt">&lt;/range&gt;</span>
<span class="linenos">70</span><span class="w">        </span><span class="nt">&lt;noise&gt;</span>
<span class="linenos">71</span><span class="w">          </span><span class="nt">&lt;type&gt;</span>gaussian<span class="nt">&lt;/type&gt;</span>
<span class="linenos">72</span><span class="w">          </span><span class="nt">&lt;mean&gt;</span>0.0<span class="nt">&lt;/mean&gt;</span>
<span class="linenos">73</span><span class="w">          </span><span class="nt">&lt;stddev&gt;</span>0.02<span class="nt">&lt;/stddev&gt;</span>
<span class="linenos">74</span><span class="w">        </span><span class="nt">&lt;/noise&gt;</span>
<span class="linenos">75</span><span class="w">      </span><span class="nt">&lt;/ray&gt;</span>
<span class="linenos">76</span><span class="w">      </span><span class="nt">&lt;always_on&gt;</span>1<span class="nt">&lt;/always_on&gt;</span>
<span class="linenos">77</span><span class="w">      </span><span class="nt">&lt;visualize&gt;</span>true<span class="nt">&lt;/visualize&gt;</span>
<span class="linenos">78</span><span class="w">    </span><span class="nt">&lt;/sensor&gt;</span>
<span class="linenos">79</span><span class="w">  </span><span class="nt">&lt;/gazebo&gt;</span>
<span class="linenos">80</span><span class="w">  </span><span class="nt">&lt;gazebo&gt;</span>
<span class="linenos">81</span><span class="w">    </span><span class="nt">&lt;plugin</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;libignition-gazebo-sensors-system.so&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ignition::gazebo::systems::Sensors&quot;</span><span class="nt">&gt;</span>
<span class="linenos">82</span><span class="w">      </span><span class="nt">&lt;render_engine&gt;</span>ogre2<span class="nt">&lt;/render_engine&gt;</span>
<span class="linenos">83</span><span class="w">    </span><span class="nt">&lt;/plugin&gt;</span>
<span class="linenos">84</span><span class="w">  </span><span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<p>The individual lines will not be discussed in detail, but this offers you an example of how a Lidar sensor can be implemented.  It also demonstrates how you can define properties such as the min/max range of the sensor or how many beams it has.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This sensor has been based on the <a class="reference external" href="https://www.sick.com/tr/en/catalog/products/lidar-and-radar-sensors/lidar-sensors/tim/tim551-2050001/p/p343045?tab=detail">SICK TiM550</a> series of 2D lidar.  The link shows the technical information of the sensor.</p>
</div>
</section>
<section id="imu">
<h3>IMU<a class="headerlink" href="#imu" title="Permalink to this heading"></a></h3>
<p>Inertial measurement units are ubiquitous, therefore, it is expected that nearly all mobile robots will have one (less so for manipulators).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 87</span><span class="w">  </span><span class="nt">&lt;gazebo</span><span class="w"> </span><span class="na">reference=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
<span class="linenos"> 88</span><span class="w">    </span><span class="nt">&lt;sensor</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;imu_sensor&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;imu&quot;</span><span class="nt">&gt;</span>
<span class="linenos"> 89</span><span class="w">      </span><span class="nt">&lt;topic&gt;</span>/model/diff_drive_example/imu<span class="nt">&lt;/topic&gt;</span>
<span class="linenos"> 90</span><span class="w">      </span><span class="nt">&lt;frame_id&gt;</span>base_link<span class="nt">&lt;/frame_id&gt;</span>
<span class="linenos"> 91</span><span class="w">      </span><span class="nt">&lt;ignition_frame_id&gt;</span>base_link<span class="nt">&lt;/ignition_frame_id&gt;</span>
<span class="linenos"> 92</span><span class="w">      </span><span class="nt">&lt;plugin</span><span class="w"> </span><span class="na">filename=</span><span class="s">&quot;libignition-gazebo-imu-system.so&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ignition::gazebo::systems::Imu&quot;</span><span class="nt">&gt;</span>
<span class="linenos"> 93</span><span class="w">        </span><span class="nt">&lt;initial_orientation_as_reference&gt;</span>false<span class="nt">&lt;/initial_orientation_as_reference&gt;</span>
<span class="linenos"> 94</span><span class="w">      </span><span class="nt">&lt;/plugin&gt;</span>
<span class="linenos"> 95</span><span class="w">      </span><span class="nt">&lt;always_on&gt;</span>true<span class="nt">&lt;/always_on&gt;</span>
<span class="linenos"> 96</span><span class="w">      </span><span class="nt">&lt;update_rate&gt;</span>100<span class="nt">&lt;/update_rate&gt;</span>
<span class="linenos"> 97</span><span class="w">      </span><span class="nt">&lt;visualize&gt;</span>true<span class="nt">&lt;/visualize&gt;</span>
<span class="linenos"> 98</span><span class="w">     </span><span class="nt">&lt;imu&gt;</span>
<span class="linenos"> 99</span><span class="w">     	</span><span class="nt">&lt;angular_velocity&gt;</span>
<span class="linenos">100</span><span class="w">     	  </span><span class="nt">&lt;x&gt;</span>
<span class="linenos">101</span><span class="w">     	    </span><span class="nt">&lt;noise</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gaussian&quot;</span><span class="nt">&gt;</span>
<span class="linenos">102</span><span class="w">              </span><span class="nt">&lt;mean&gt;</span>0.0<span class="nt">&lt;/mean&gt;</span>
<span class="linenos">103</span><span class="w">              </span><span class="nt">&lt;stddev&gt;</span>2e-4<span class="nt">&lt;/stddev&gt;</span>
<span class="linenos">104</span><span class="w">              </span><span class="nt">&lt;bias_mean&gt;</span>0.0000075<span class="nt">&lt;/bias_mean&gt;</span>
<span class="linenos">105</span><span class="w">              </span><span class="nt">&lt;bias_stddev&gt;</span>0.0000008<span class="nt">&lt;/bias_stddev&gt;</span>
<span class="linenos">106</span><span class="w">            </span><span class="nt">&lt;/noise&gt;</span>
<span class="linenos">107</span><span class="w">          </span><span class="nt">&lt;/x&gt;</span>
<span class="linenos">108</span><span class="w">          </span><span class="nt">&lt;y&gt;</span>
<span class="linenos">109</span><span class="w">            </span><span class="nt">&lt;noise</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gaussian&quot;</span><span class="nt">&gt;</span>
<span class="linenos">110</span><span class="w">              </span><span class="nt">&lt;mean&gt;</span>0.0<span class="nt">&lt;/mean&gt;</span>
<span class="linenos">111</span><span class="w">              </span><span class="nt">&lt;stddev&gt;</span>2e-4<span class="nt">&lt;/stddev&gt;</span>
<span class="linenos">112</span><span class="w">              </span><span class="nt">&lt;bias_mean&gt;</span>0.0000075<span class="nt">&lt;/bias_mean&gt;</span>
<span class="linenos">113</span><span class="w">              </span><span class="nt">&lt;bias_stddev&gt;</span>0.0000008<span class="nt">&lt;/bias_stddev&gt;</span>
<span class="linenos">114</span><span class="w">            </span><span class="nt">&lt;/noise&gt;</span>
<span class="linenos">115</span><span class="w">          </span><span class="nt">&lt;/y&gt;</span>
<span class="linenos">116</span><span class="w">          </span><span class="nt">&lt;z&gt;</span>
<span class="linenos">117</span><span class="w">            </span><span class="nt">&lt;noise</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gaussian&quot;</span><span class="nt">&gt;</span>
<span class="linenos">118</span><span class="w">              </span><span class="nt">&lt;mean&gt;</span>0.0<span class="nt">&lt;/mean&gt;</span>
<span class="linenos">119</span><span class="w">              </span><span class="nt">&lt;stddev&gt;</span>2e-4<span class="nt">&lt;/stddev&gt;</span>
<span class="linenos">120</span><span class="w">              </span><span class="nt">&lt;bias_mean&gt;</span>0.0000075<span class="nt">&lt;/bias_mean&gt;</span>
<span class="linenos">121</span><span class="w">              </span><span class="nt">&lt;bias_stddev&gt;</span>0.0000008<span class="nt">&lt;/bias_stddev&gt;</span>
<span class="linenos">122</span><span class="w">            </span><span class="nt">&lt;/noise&gt;</span>
<span class="linenos">123</span><span class="w">          </span><span class="nt">&lt;/z&gt;</span>
<span class="linenos">124</span><span class="w">        </span><span class="nt">&lt;/angular_velocity&gt;</span>
<span class="linenos">125</span><span class="w">        </span><span class="nt">&lt;linear_acceleration&gt;</span>
<span class="linenos">126</span><span class="w">          </span><span class="nt">&lt;x&gt;</span>
<span class="linenos">127</span><span class="w">            </span><span class="nt">&lt;noise</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gaussian&quot;</span><span class="nt">&gt;</span>
<span class="linenos">128</span><span class="w">              </span><span class="nt">&lt;mean&gt;</span>0.0<span class="nt">&lt;/mean&gt;</span>
<span class="linenos">129</span><span class="w">              </span><span class="nt">&lt;stddev&gt;</span>1.7e-2<span class="nt">&lt;/stddev&gt;</span>
<span class="linenos">130</span><span class="w">              </span><span class="nt">&lt;bias_mean&gt;</span>0.1<span class="nt">&lt;/bias_mean&gt;</span>
<span class="linenos">131</span><span class="w">              </span><span class="nt">&lt;bias_stddev&gt;</span>0.001<span class="nt">&lt;/bias_stddev&gt;</span>
<span class="linenos">132</span><span class="w">            </span><span class="nt">&lt;/noise&gt;</span>
<span class="linenos">133</span><span class="w">          </span><span class="nt">&lt;/x&gt;</span>
<span class="linenos">134</span><span class="w">          </span><span class="nt">&lt;y&gt;</span>
<span class="linenos">135</span><span class="w">            </span><span class="nt">&lt;noise</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gaussian&quot;</span><span class="nt">&gt;</span>
<span class="linenos">136</span><span class="w">              </span><span class="nt">&lt;mean&gt;</span>0.0<span class="nt">&lt;/mean&gt;</span>
<span class="linenos">137</span><span class="w">              </span><span class="nt">&lt;stddev&gt;</span>1.7e-2<span class="nt">&lt;/stddev&gt;</span>
<span class="linenos">138</span><span class="w">              </span><span class="nt">&lt;bias_mean&gt;</span>0.1<span class="nt">&lt;/bias_mean&gt;</span>
<span class="linenos">139</span><span class="w">              </span><span class="nt">&lt;bias_stddev&gt;</span>0.001<span class="nt">&lt;/bias_stddev&gt;</span>
<span class="linenos">140</span><span class="w">            </span><span class="nt">&lt;/noise&gt;</span>
<span class="linenos">141</span><span class="w">          </span><span class="nt">&lt;/y&gt;</span>
<span class="linenos">142</span><span class="w">          </span><span class="nt">&lt;z&gt;</span>
<span class="linenos">143</span><span class="w">            </span><span class="nt">&lt;noise</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gaussian&quot;</span><span class="nt">&gt;</span>
<span class="linenos">144</span><span class="w">              </span><span class="nt">&lt;mean&gt;</span>0.0<span class="nt">&lt;/mean&gt;</span>
<span class="linenos">145</span><span class="w">              </span><span class="nt">&lt;stddev&gt;</span>1.7e-2<span class="nt">&lt;/stddev&gt;</span>
<span class="linenos">146</span><span class="w">              </span><span class="nt">&lt;bias_mean&gt;</span>0.1<span class="nt">&lt;/bias_mean&gt;</span>
<span class="linenos">147</span><span class="w">              </span><span class="nt">&lt;bias_stddev&gt;</span>0.001<span class="nt">&lt;/bias_stddev&gt;</span>
<span class="linenos">148</span><span class="w">            </span><span class="nt">&lt;/noise&gt;</span>
<span class="linenos">149</span><span class="w">          </span><span class="nt">&lt;/z&gt;</span>
<span class="linenos">150</span><span class="w">        </span><span class="nt">&lt;/linear_acceleration&gt;</span>
<span class="linenos">151</span><span class="w">      </span><span class="nt">&lt;/imu&gt;</span>
<span class="linenos">152</span><span class="w">    </span><span class="nt">&lt;/sensor&gt;</span>
<span class="linenos">153</span><span class="w">  </span><span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<p>Notice that for each axis of the gyro and accelometer (six in total), there is a <code class="docutils literal notranslate"><span class="pre">&lt;noise&gt;</span></code> tag.  Once again, characterisation of real sensor hardware can tell us what these values <em>should</em> be in our simulation.</p>
</section>
</section>
<section id="general-physics">
<h2>General physics<a class="headerlink" href="#general-physics" title="Permalink to this heading"></a></h2>
<p>For our robot to have the wheels stick to the floor, but the castors slide, the coefficients of friction need to modified.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos">155</span><span class="w">  </span><span class="cm">&lt;!-- FRICTION AND PHYSICS --&gt;</span>
<span class="linenos">156</span><span class="w">  </span><span class="nt">&lt;gazebo</span><span class="w"> </span><span class="na">reference=</span><span class="s">&quot;back_castor_link&quot;</span><span class="nt">&gt;</span>
<span class="linenos">157</span><span class="w">    </span><span class="nt">&lt;mu1</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.00001&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">158</span><span class="w">    </span><span class="nt">&lt;mu2</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.00001&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">159</span><span class="w">  </span><span class="nt">&lt;/gazebo&gt;</span>
<span class="linenos">160</span><span class="w">  </span>
<span class="linenos">161</span><span class="w">  </span><span class="nt">&lt;gazebo</span><span class="w"> </span><span class="na">reference=</span><span class="s">&quot;front_castor_link&quot;</span><span class="nt">&gt;</span>
<span class="linenos">162</span><span class="w">    </span><span class="nt">&lt;mu1</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.00001&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">163</span><span class="w">    </span><span class="nt">&lt;mu2</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.00001&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">164</span><span class="w">  </span><span class="nt">&lt;/gazebo&gt;</span>
<span class="linenos">165</span>
<span class="linenos">166</span><span class="w">  </span><span class="nt">&lt;gazebo</span><span class="w"> </span><span class="na">reference=</span><span class="s">&quot;wheel_right&quot;</span><span class="nt">&gt;</span>
<span class="linenos">167</span><span class="w">    </span><span class="nt">&lt;mu1</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">168</span><span class="w">    </span><span class="nt">&lt;mu2</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">169</span><span class="w">  </span><span class="nt">&lt;/gazebo&gt;</span>
<span class="linenos">170</span>
<span class="linenos">171</span><span class="w">  </span><span class="nt">&lt;gazebo</span><span class="w"> </span><span class="na">reference=</span><span class="s">&quot;wheel_left&quot;</span><span class="nt">&gt;</span>
<span class="linenos">172</span><span class="w">    </span><span class="nt">&lt;mu1</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">173</span><span class="w">    </span><span class="nt">&lt;mu2</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">174</span><span class="w">  </span><span class="nt">&lt;/gazebo&gt;</span>
<span class="linenos">175</span>
<span class="linenos">176</span>
<span class="linenos">177</span><span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>The front and rear castors have their friction values set to a very small value (1e-5), whereas the wheels have a large coefficient value.  The actual definitions of <code class="docutils literal notranslate"><span class="pre">&lt;mu&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;mu2&gt;</span></code> are not important for this example, but more details can be found <a class="reference external" href="https://github.com/osrf/gazebo_tutorials/blob/master/friction/tutorial.md">here on GitHub</a>, <a class="reference external" href="https://classic.gazebosim.org/tutorials?tut=friction">here on Gazebo Classic docs</a> and <a class="reference external" href="https://www.althack.dev/ignition_vs_gazebo/friction/#">here on a third party forum</a>.  As a general rule, the two values should be identical.</p>
<p>Now we have examined the gazebo plugins.  The next section will run the simulation and explore how to link it into ROS more closely.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="week08_tut_intro.html" class="btn btn-neutral float-left" title="Setting Up a Simulation in Gazebo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="week08_tut_gazeboros.html" class="btn btn-neutral float-right" title="Linking Gazebo and ROS2" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Andy West.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>