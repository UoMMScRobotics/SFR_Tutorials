

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Maps creations &mdash; Software for Robotics Tutorials  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
      <link rel="stylesheet" type="text/css" href="_static/theme_mods.css?v=a1f80f96" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
      <script src="_static/doctools.js?v=888ff710"></script>
      <script src="_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script src="_static/design-tabs.js?v=36754332"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="contents.html" class="icon icon-home">
            Software for Robotics Tutorials
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Welcome</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Software for Robotics Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 07 | URDF</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_intro.html">Describing Robots using URDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_joints.html">Adding Joints</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_links.html">Adding Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_collisions.html">Adding Collisions and Inertia</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 08 | Simulations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week08_tut_intro.html">Setting Up a Simulation in Gazebo</a></li>
<li class="toctree-l1"><a class="reference internal" href="week08_tut_gazeboxacro.html">Adding Simulation Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="week08_tut_gazeboros.html">Linking Gazebo and ROS2</a></li>
<li class="toctree-l1"><a class="reference internal" href="week08_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 09 | Maps and SLAM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_intro.html">Sensing and Perception for Navigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_maps.html">Maps and Occupancy Grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_localisation.html">Localisation in a Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_slam.html">SLAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 10 | Autonomous Navigation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_intro.html">Autonomous Navigation Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_pathplan.html">Adding Path Planning from Nav2</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_controller.html">Adding a Controller from Nav2</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_commands.html">Sending Goals to the Robot Navigation Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 11 | Behaviour Trees</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_intro.html">Behaviour Trees Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_groot.html">Investigating Behaviour Trees with Groot</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_simplebt.html">Building a Behaviour Tree with Groot</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_usingsimplebt.html">Using a Custom Behaviour Tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_addreplanning.html">Adding Replanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_conclusion.html">Conclusion</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="contents.html">Software for Robotics Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="contents.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Maps creations</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="maps-creations">
<h1>Maps creations<a class="headerlink" href="#maps-creations" title="Permalink to this heading"></a></h1>
<p>In the previous part of this tutorial you have been shown how to use existing map of an environment and how to create one by driving around in simulated world. Here we will show you how to create and import map into gazebo from nothing.</p>
<p>This skill is useful for example if you want to quickly test your robot in a new map or you collected LIDAR scan of real environment and you want to have in your Gazebo for testing.</p>
<p>Generally there are few ways you can go about it</p>
<blockquote>
<div><ul class="simple">
<li><p>Model your environment as .sdf</p></li>
<li><p>Model your environment in design software (such as solidworks) and export it as .stl file</p></li>
<li><p>Draw (or collected using real robot) your maps as .pgm, create assosciated .yaml file and convert those to .stl file.</p></li>
</ul>
</div></blockquote>
<p>In SfR module only third method is explored. In this method following steps are necessary</p>
<ul class="simple">
<li><p>Draw your map as .pgm in your favourite image creation tool (here GIMP will be used)</p></li>
<li><p>Create assosciated .yaml and .pgn file (this can be done automatically using Python script)</p></li>
<li><p>Create map .stl file using ‘map2gazebo &lt;<a class="reference external" href="https://github.com/Adlink-ROS/map2gazebo">https://github.com/Adlink-ROS/map2gazebo</a>&gt;’ _ package</p></li>
<li><p>Import into gazebo</p></li>
</ul>
</section>
<section id="drawing-the-map">
<h1>Drawing the map<a class="headerlink" href="#drawing-the-map" title="Permalink to this heading"></a></h1>
<p>If you look inside .pgm file you will observe it is simply greyscale image with empty spaces represented by white colour and taken by black colour (for the sake of simplicty we will ignore unknown spaces, you are not required to know how to deal with those).</p>
<p>We can easily create such a picture using any graphical editing software. Here we will use GIMP. You can install GIMP by running:</p>
<p>Start gimp and you should see:</p>
<a class="reference internal image-reference" href="_images/gimp_initial.png"><img alt="RViz screen capture of a published map." class="align-center" src="_images/gimp_initial.png" style="width: 800px;" /></a>
<p>click <em>file</em> &gt; <em>new</em> You should see:</p>
<a class="reference internal image-reference" href="_images/new_image_window.png"><img alt="RViz screen capture of a published map." class="align-center" src="_images/new_image_window.png" style="width: 800px;" /></a>
<p>just click <em>ok</em> to accept the default settings. You can now draw a simple map using paintbrush tool as highlighted in picture below.</p>
<a class="reference internal image-reference" href="_images/blank_image.png"><img alt="RViz screen capture of a published map." class="align-center" src="_images/blank_image.png" style="width: 800px;" /></a>
<p>Just write ROS like so:</p>
<a class="reference internal image-reference" href="_images/ROS_written.png"><img alt="RViz screen capture of a published map." class="align-center" src="_images/ROS_written.png" style="width: 800px;" /></a>
<p>click <em>file</em> &gt; <em>save</em> and save it in <code class="docutils literal notranslate"><span class="pre">.../example_gz_robot/world/</span></code> as custom_map.xcf. We also need to export to .png. to do this click <em>file</em> &gt; <em>export</em>, Change file extension to <em>.png</em> like so:</p>
<a class="reference internal image-reference" href="_images/Saving.png"><img alt="RViz screen capture of a published map." class="align-center" src="_images/Saving.png" style="width: 800px;" /></a>
<p>Click <em>export</em> then <em>export</em> again in the pop-up window. This completes steps 1</p>
</section>
<section id="create-yaml-and-pgm-file">
<h1>Create .yaml and .pgm file<a class="headerlink" href="#create-yaml-and-pgm-file" title="Permalink to this heading"></a></h1>
<p>the .YAML file contains information which allows determination of size of the map (i.e. length of each pixel). While we could do it manually it is a lot more convinent to do so using a script. Please download <a class="reference external" href="../../ros_ws/src/MakeROSMap.py">Download script</a> script and put it in <code class="docutils literal notranslate"><span class="pre">.../example_gz_robot/world/</span></code> directory. Open terminal in <code class="docutils literal notranslate"><span class="pre">.../example_gz_robot/world/</span></code> folder and type:</p>
<p>This will open interactive command-line tool where you have to type the following:</p>
<p>and press <em>Enter</em></p>
<p>Now we have to select two x-coordinates and two Y coordinates for package to measure dimension. For x coordinate we want to select bottom of letter ‘R’ and ‘S’ as highlighted in picture below with red dots.</p>
<a class="reference internal image-reference" href="_images/ROS_coordinates_x.png"><img alt="RViz screen capture of a published map." class="align-center" src="_images/ROS_coordinates_x.png" style="width: 800px;" /></a>
<p>This does not have to be exact right. Once two x-coordinates are selected you should type</p>
<p>and press <em>Enter</em></p>
<p>To indicate we want this distance to be 4 meters. then the same with indicate Y-coordinates this time top and bottom of R as indicated in picture below.</p>
<a class="reference internal image-reference" href="_images/ROS_coordinates_y.png"><img alt="RViz screen capture of a published map." class="align-center" src="_images/ROS_coordinates_y.png" style="width: 800px;" /></a>
<p>We also type:</p>
<p>and press <em>Enter</em>. then for question about the new name we just type:</p>
<p>and press <em>Enter</em> twice. We should know see in Nautilus two new files being added, custom_map.pgm and custom_map.yaml, both needed by ROS.</p>
<a class="reference internal image-reference" href="_images/Files_Ready.png"><img alt="RViz screen capture of a published map." class="align-center" src="_images/Files_Ready.png" style="width: 800px;" /></a>
</section>
<section id="create-stl-file">
<h1>Create .stl file<a class="headerlink" href="#create-stl-file" title="Permalink to this heading"></a></h1>
<p>Now that we have map file we can use in map server, we also need to create assosciated .stl file for usage in Gazebo. STL files are 3D graphical files (you can find more info ‘here &lt;<a class="reference external" href="https://www.adobe.com/creativecloud/file-types/image/vector/stl-file.html">https://www.adobe.com/creativecloud/file-types/image/vector/stl-file.html</a>&gt;’ _). So far we have 2D map only, we will create 3D equivalent by simply extruding walls from exisitng map. To do so we will use ‘map2gazebo &lt;<a class="reference external" href="https://github.com/Adlink-ROS/map2gazebo">https://github.com/Adlink-ROS/map2gazebo</a>&gt;’ _ repository. To install follow the instruction from the repository. After installation we will be using offline instructions. Thus open new terminal in  <code class="docutils literal notranslate"><span class="pre">.../example_gz_robot/world/</span></code> folder and type in:</p>
<p>This should create custom_map.stl file which we can use in gazebo</p>
</section>
<section id="importing-into-gazebo">
<h1>Importing into Gazebo<a class="headerlink" href="#importing-into-gazebo" title="Permalink to this heading"></a></h1>
<p>To import into gazebo, first copy custom_map.stl into <code class="docutils literal notranslate"><span class="pre">meshes</span></code> folder (just to keep your folder clean). Then, we need .sdf file. for the sake of this tutorial you don’t need to know or understand .sdf files but syntax should be familar to you as they are similar to URDF files. Download .sdf file from here and put it inside <code class="docutils literal notranslate"><span class="pre">worlds</span></code> folder. In essence this file tells gazebo where to look for STL file as well as some basic properties of it. In lines outlined below, we need to define the name of our custom stl file:</p>
<p>Then we have to tell our <em>example_gz_robot</em> package to use our sdf file, as well as that it needs to install our new map.</p>
<p>We start by modifying line 41 in launch file <code class="docutils literal notranslate"><span class="pre">simulation_bringup.launch.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>    <span class="n">sdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;example_gz_robot&#39;</span><span class="p">),</span> <span class="s1">&#39;worlds&#39;</span><span class="p">,</span> <span class="s1">&#39;tb3.sdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>with
.. code-block:: python</p>
<blockquote>
<div><p>sdf_path = os.path.join(get_package_share_directory(‘example_gz_robot’), ‘worlds’, ‘model.sdf’)</p>
</div></blockquote>
<p>This just tells launch file to look for new sdf file. Now you can run the SLAM demonstration with new map!</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Andy West.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>