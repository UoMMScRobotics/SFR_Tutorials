

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Maps creations &mdash; Software for Robotics Tutorials  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
      <link rel="stylesheet" type="text/css" href="_static/theme_mods.css?v=a1f80f96" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
      <script src="_static/doctools.js?v=888ff710"></script>
      <script src="_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script src="_static/design-tabs.js?v=36754332"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Conclusion" href="week09_tut_conclusion.html" />
    <link rel="prev" title="SLAM" href="week09_tut_slam.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="contents.html" class="icon icon-home">
            Software for Robotics Tutorials
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Welcome</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Software for Robotics Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 07 | URDF</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_intro.html">Describing Robots using URDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_joints.html">Adding Joints</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_links.html">Adding Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_collisions.html">Adding Collisions and Inertia</a></li>
<li class="toctree-l1"><a class="reference internal" href="week07_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 08 | Simulations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week08_tut_intro.html">Setting Up a Simulation in Gazebo</a></li>
<li class="toctree-l1"><a class="reference internal" href="week08_tut_gazeboxacro.html">Adding Simulation Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="week08_tut_gazeboros.html">Linking Gazebo and ROS2</a></li>
<li class="toctree-l1"><a class="reference internal" href="week08_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 09 | Maps and SLAM</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="week09_tut_intro.html">Sensing and Perception for Navigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_maps.html">Maps and Occupancy Grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_localisation.html">Localisation in a Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_slam.html">SLAM</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Maps creations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#drawing-the-map">Drawing the map</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-yaml-and-pgm-file">Create .yaml and .pgm file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-stl-file">Create .stl file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#importing-into-gazebo">Importing into Gazebo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="week09_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 10 | Autonomous Navigation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_intro.html">Autonomous Navigation Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_pathplan.html">Adding Path Planning from Nav2</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_controller.html">Adding a Controller from Nav2</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_commands.html">Sending Goals to the Robot Navigation Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="week10_tut_conclusion.html">Conclusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Week 11 | Behaviour Trees</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_intro.html">Behaviour Trees Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_groot.html">Investigating Behaviour Trees with Groot</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_simplebt.html">Building a Behaviour Tree with Groot</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_usingsimplebt.html">Using a Custom Behaviour Tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_addreplanning.html">Adding Replanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="week11_tut_conclusion.html">Conclusion</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="contents.html">Software for Robotics Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="contents.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Maps creations</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="maps-creations">
<h1>Maps creations<a class="headerlink" href="#maps-creations" title="Permalink to this heading"></a></h1>
<p>In the previous part of this tutorial you have been shown how to use existing map of an environment and how to create one by driving around in simulated world. Here we will show you how to create and import map into gazebo from nothing.</p>
<p>This skill is useful for example if you want to quickly test your robot in a new map or you collected LIDAR scan of real environment and you want to have in your Gazebo for testing.</p>
<p>Generally there are few ways you can go about it</p>
<ul class="simple">
<li><p>Model your environment as .sdf</p></li>
<li><p>Model your environment in design software (such as solidworks) and export it as .stl file</p></li>
<li><p>Draw (or collected using real robot) your maps as .pgm, create assosciated .yaml file and convert those to .stl file.</p></li>
</ul>
<p>In SfR module only third method is explored. In this method following steps are necessary</p>
<ul class="simple">
<li><p>Draw your map as .png in your favourite image creation tool (here GIMP will be used)</p></li>
<li><p>Create assosciated .yaml and .pgm file (this can be done automatically using Python script)</p></li>
<li><p>Create map .stl file using <a class="reference external" href="https://github.com/Adlink-ROS/map2gazebo">map2gazebo</a> package</p></li>
<li><p>Import into gazebo</p></li>
</ul>
<section id="drawing-the-map">
<h2>Drawing the map<a class="headerlink" href="#drawing-the-map" title="Permalink to this heading"></a></h2>
<p>If you look inside .pgm file you will observe it is simply greyscale image with empty spaces represented by white colour and occupied by black colour (for the sake of simplicty we will ignore unknown spaces, you are not required to know how to deal with those).</p>
<p>We can easily create such a picture using any graphical editing software. Here we will use GIMP. You can install GIMP by running:</p>
<p>Start gimp and you should see:</p>
<a class="reference internal image-reference" href="_images/gimp_initial.png"><img alt="starting window from GIMP." class="align-center" src="_images/gimp_initial.png" style="width: 800px;" /></a>
<p>click <em>file</em> &gt; <em>new</em> You should see:</p>
<a class="reference internal image-reference" href="_images/new_image_window.png"><img alt="New image creation in GIMP." class="align-center" src="_images/new_image_window.png" style="width: 800px;" /></a>
<p>just click <em>ok</em> to accept the default settings. You can now draw a simple map using paintbrush tool as highlighted in picture below.</p>
<a class="reference internal image-reference" href="_images/blank_image.png"><img alt="Blank image in GIMP." class="align-center" src="_images/blank_image.png" style="width: 800px;" /></a>
<p>Just write ROS using paintbrush like so:</p>
<a class="reference internal image-reference" href="_images/ROS_written.png"><img alt="ROS map." class="align-center" src="_images/ROS_written.png" style="width: 800px;" /></a>
<p>The particular size does not matter as long as all the letters are clearly visible. The scale and dimensions will be dealt with in the next step. Click <em>file</em> &gt; <em>save</em> and save it in <code class="docutils literal notranslate"><span class="pre">.../example_gz_robot/world/</span></code> as custom_map.xcf. We also need to export to .png. to do this click <em>file</em> &gt; <em>export</em>, Change file extension to <em>.png</em> like so:</p>
<a class="reference internal image-reference" href="_images/Saving.png"><img alt="Saving ros map." class="align-center" src="_images/Saving.png" style="width: 800px;" /></a>
<p>Click <em>export</em> then <em>export</em> again in the pop-up window. This completes step 1.</p>
</section>
<section id="create-yaml-and-pgm-file">
<h2>Create .yaml and .pgm file<a class="headerlink" href="#create-yaml-and-pgm-file" title="Permalink to this heading"></a></h2>
<p>the .YAML file contains information which allows determination of size of the map (i.e. length of each pixel), while .pgm is ROS acceptable format for maps. While we could do it manually it is a lot more convinent to do so using a script. Please download <a class="reference external" href="../../ros_ws/src/MakeROSMap.py">script</a> (this script was originally part of <a class="reference external" href="https://github.com/ycprobotics/ROS-Map-Generator/tree/master">ROS-Map-Generator</a> , It was modified here to to work with Python3) and put it in <code class="docutils literal notranslate"><span class="pre">.../example_gz_robot/world/</span></code> directory. Open terminal in <code class="docutils literal notranslate"><span class="pre">.../example_gz_robot/world/</span></code> folder and type:</p>
<p>If you get any error run following python installation commands:
.. code-block:: console</p>
<blockquote>
<div><p>pip3 install trimesh
pip3 install numpy
pip3 install pycollada
pip3 install scipy
pip3 install networkx
pip3 install opencv-contrib-python</p>
</div></blockquote>
<p>This will open interactive command-line tool where you have to type the following:</p>
<p>and press <em>Enter</em></p>
<p>Now we have to select two x-coordinates and two Y coordinates for package to measure dimension. For x coordinate we want to select bottom of letter ‘R’ and ‘S’ as highlighted in picture below with red dots.</p>
<a class="reference internal image-reference" href="_images/ROS_coordinates_x.png"><img alt="RViz screen capture of a published map." class="align-center" src="_images/ROS_coordinates_x.png" style="width: 800px;" /></a>
<p>This does not have to be exact right. Once two x-coordinates are selected you should type</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">4</span>
</pre></div>
</div>
<p>and press <em>Enter</em></p>
<p>To indicate we want this distance to be 4 meters. then to indicate Y-coordinates top and bottom of R should be marked as outlined below.</p>
<a class="reference internal image-reference" href="_images/ROS_coordinates_y.png"><img alt="RViz screen capture of a published map." class="align-center" src="_images/ROS_coordinates_y.png" style="width: 800px;" /></a>
<p>We also type:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">4</span>
</pre></div>
</div>
<p>and press <em>Enter</em>. then for question about the new name we just type:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">custom_map</span>
</pre></div>
</div>
<p>and press <em>Enter</em> twice. We should know see in Nautilus two new files being added, custom_map.pgm and custom_map.yaml, both needed by ROS.</p>
<a class="reference internal image-reference" href="_images/Files_Ready.png"><img alt="RViz screen capture of a published map." class="align-center" src="_images/Files_Ready.png" style="width: 800px;" /></a>
</section>
<section id="create-stl-file">
<h2>Create .stl file<a class="headerlink" href="#create-stl-file" title="Permalink to this heading"></a></h2>
<p>Now that we have map file we can use in map server, we also need to create assosciated .stl file for usage in Gazebo. STL files are 3D graphical files (you can find more info <a class="reference external" href="https://www.adobe.com/creativecloud/file-types/image/vector/stl-file.html">here</a>). So far we have 2D map only, we will create 3D equivalent by simply extruding walls from exisitng map. To do so we will use <a class="reference external" href="https://github.com/Adlink-ROS/map2gazebo">map2gazebo</a> repository. To install follow the installation instruction from the repository. After installation we will be using offline instructions. Thus open new terminal in  <code class="docutils literal notranslate"><span class="pre">.../example_gz_robot/world/</span></code> folder and type in:</p>
<p>This should create custom_map.stl file which we can use in gazebo</p>
</section>
<section id="importing-into-gazebo">
<h2>Importing into Gazebo<a class="headerlink" href="#importing-into-gazebo" title="Permalink to this heading"></a></h2>
<p>To import into gazebo, first copy custom_map.stl into <code class="docutils literal notranslate"><span class="pre">meshes</span></code> folder (just to keep your folder clean). Then, we need .sdf file. Download .sdf file from <a class="reference external" href=".../../ros_ws/src/example_gz_robot/worlds/model.sdf">here</a> (this is slightly modified sdf file from <a class="reference external" href="https://github.com/Adlink-ROS/map2gazebo">map2gazebo</a> repository) and put it inside <code class="docutils literal notranslate"><span class="pre">worlds</span></code> folder. In essence this file tells gazebo where to look for STL file as well as some basic properties of it. Look inside sdf file, in the lines outlined below we defined the name of our custom stl file:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos">20</span><span class="w">            </span><span class="nt">&lt;uri&gt;</span>model://custom_map.stl<span class="nt">&lt;/uri&gt;</span>
</pre></div>
</div>
<p>This is simple modification of Launch file <a href="#id4"><span class="problematic" id="id5">``</span></a>simulation_bringup.launch.py``in line 41.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>    <span class="n">sdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;example_gz_robot&#39;</span><span class="p">),</span> <span class="s1">&#39;worlds&#39;</span><span class="p">,</span> <span class="s1">&#39;tb3.sdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;example_gz_robot&#39;</span><span class="p">),</span> <span class="s1">&#39;worlds&#39;</span><span class="p">,</span> <span class="s1">&#39;model.sdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This just tells launch file to look for new sdf file. Now you can fully use your new map. Launch the SLAM like before:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source ~/&lt;YOUR_ROS_WS&gt;/install/setup.bash</span>
<span class="go">ros2 launch example_gz_robot slam.launch.py</span>
</pre></div>
</div>
<p>You should see your new map in Gazebo and laser scan in RVIZ. Drive the robot around to complete the map in RVIZ.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="week09_tut_slam.html" class="btn btn-neutral float-left" title="SLAM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="week09_tut_conclusion.html" class="btn btn-neutral float-right" title="Conclusion" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Andy West.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>